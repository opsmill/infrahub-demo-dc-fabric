name: avdasymirb

topology:
  
  kinds:
    ceos:
      startup-config: ceos.cfg.tpl
      image: 9r2s1098.c1.gra9.container-registry.ovh.net/external/ceos_image:latest
      exec:
        - sleep 10
        - FastCli -p 15 -c 'security pki key generate rsa 4096 eAPI.key'
        - FastCli -p 15 -c 'security pki certificate generate self-signed eAPI.crt key eAPI.key generate rsa 4096 validity 30000 parameters common-name eAPI'
    linux:
      image: 9r2s1098.c1.gra9.container-registry.ovh.net/external/alpine-host:latest

  nodes:
{% for device in data.InfraDevice.edges %}
    {{ device.node.name.value }}:
      kind: {{ device.node.type.value }}
{%  for intf in device.node.interfaces.edges %}
{%    if intf.node.role.node.name.value == "management" %}
{%      set management_ip = intf.node.ip_addresses.edges[0].node.address.value.split('/') %}
      mgmt_ipv4: {{ management_ip[0] }}
{%    endif %}
{%  endfor %}
      startup-config: configs/startup/{{ device.node.name.value }}.cfg
{%  if device.node.type.value == "linux" %}
      env:
        TMODE: lacp
{%  endif %}
{% endfor %}

  links:
    - endpoints: ["atl-leaf1:eth3", "atl-spine1:eth3"]
    - endpoints: ["atl-leaf2:eth3", "atl-spine1:eth4"]
    - endpoints: ["atl-leaf3:eth3", "atl-spine1:eth5"]
    - endpoints: ["atl-leaf4:eth3", "atl-spine1:eth6"]
    - endpoints: ["atl-leaf1:eth4", "atl-spine2:eth3"]
    - endpoints: ["atl-leaf2:eth4", "atl-spine2:eth4"]
    - endpoints: ["atl-leaf3:eth4", "atl-spine2:eth5"]
    - endpoints: ["atl-leaf4:eth4", "atl-spine2:eth6"]
    - endpoints: ["atl-leaf1:eth5", "atl-client1:eth1"]
    - endpoints: ["atl-leaf4:eth5", "atl-client2:eth1"]

mgmt:
  network: ceos_clab                
  ipv4_subnet: 172.100.100.0/24       
  ipv6_subnet: 2001:172:100:100::/80
